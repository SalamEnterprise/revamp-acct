## üß≠ Structure Overview

| Layer                    | Tables                                         | Function                                                                                  |
| ------------------------ | ---------------------------------------------- | ----------------------------------------------------------------------------------------- |
| **Source (Business)**    | `txn_source`                                   | Raw operational transactions from upstream (policy admin, claims, billing)                |
| **Accounting (Staging)** | `je_header`, `je_line`                         | Generated journals ‚Äî each header summarizing one business event, each line a debit/credit |
| **Dimensions**           | `chart_of_accounts`, `fund_dim`, `product_dim` | Reference structures for reporting, validation, and financial statement mapping           |

## üßÆ Data Lineage Summary
| Trace Path                                              | Description                | Typical Use                     |
| ------------------------------------------------------- | -------------------------- | ------------------------------- |
| `txn_source.source_rowid ‚Üí je_header.source_rowid`      | Business ‚Üí Journal trace   | Transaction-to-accounting audit |
| `je_header.je_internal_id ‚Üí je_line.je_internal_id`     | Header ‚Üí Lines             | Ledger reconstruction           |
| `je_line.account_code ‚Üí chart_of_accounts.account_code` | Line ‚Üí Chart of Accounts   | Financial statement rollup      |
| `je_line.fund_code ‚Üí fund_dim.fund_code`                | Line ‚Üí Fund                | Takaful fund segregation        |
| `je_header.product_code ‚Üí product_dim.product_code`     | Header ‚Üí Product dimension | Product-level profitability     |

## üßæ Reporting Hierarchy (simplified)
### Trial Balance
```text
CHART_OF_ACCOUNTS
    ‚Üë
JE_LINE  ‚Üê  JE_HEADER  ‚Üê  TXN_SOURCE
```

### Fund Statement (Takaful)
```text
FUND_DIM
    ‚Üë
JE_LINE (fund movements)
```
### Product P&L
```text
PRODUCT_DIM
    ‚Üë
JE_HEADER + JE_LINE (aggregated by product_code)

```

### üß† Audit Flow Example
#### Operational control
1. Trace a specific premium receipt:
  ```sql
  SELECT * FROM txn_source WHERE source_rowid='TXN-0001234';
SELECT * FROM je_header WHERE source_rowid='TXN-0001234';
SELECT * FROM je_line WHERE source_rowid='TXN-0001234';
```
#### Accounting reconstruction
   To rebuild the ledger for October 2025:
   ```sql
   SELECT account_code, SUM(CASE WHEN side='DR' THEN amount ELSE -amount END)
   FROM je_line
   WHERE je_date BETWEEN '2025-10-01' AND '2025-10-31'GROUP BY account_code;
   ```
#### Fund segregation
Verify Tabarru / Tanahud / Operator movements:
```sql
SELECT fund_code, SUM(amount) FROM je_line GROUP BY fund_code;

```


### Complete logical structure and audit trail relationships between txn_source, je_header, and je_line

![ER Diagram](er_diagram.png)
